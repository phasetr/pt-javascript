# ライブラリバージョンアップ計画書

## 日時

2025年07月20日 06:42 (master ブランチ)

## 作業概要

S3 Vectors RAGプロジェクトのライブラリバージョンアップ。特に古いバージョンのライブラリを整合性を保てる範囲で最新化する。

## 現状分析

### 発見された古いライブラリ（要更新）

#### 1. query-api パッケージ

- `@types/node`: "^18.0.0" → "^22.0.0" (最新)
- `typescript`: "^5.0.0" → "^5.6.0" (最新)
- `esbuild`: "^0.19.0" → "^0.24.0" (最新)
- `@aws-sdk/client-cloudformation`: "^3.400.0" → "^3.692.0" (AWS SDK統一版)

#### 2. create-s3vectors-index パッケージ

- `@aws-sdk/client-s3vectors`: "^3.0.0" → "^3.692.0" (AWS SDK統一版)
- `typescript`: "^5.6.0" → 既に最新
- `vitest`: "^2.1.0" → 既に最新

#### 3. その他パッケージの確認事項

- `@langchain/aws`: "^0.1.2" (最新確認が必要)
- `@langchain/core`: "^0.3.20" (最新確認が必要)
- `@langchain/textsplitters`: "^0.1.0" (最新確認が必要)

## 作業計画

### Phase 1: AWS SDK統一

1. 全てのAWS SDKクライアントライブラリを最新の`^3.692.0`に統一
2. 互換性テストの実行

### Phase 2: Node.js系ライブラリ更新

1. `@types/node`を全て`^22.0.0`に統一
2. `typescript`を全て`^5.6.0`に統一
3. `esbuild`を全て`^0.24.0`に統一

### Phase 3: Langchain系ライブラリ調査・更新

1. 最新バージョンの調査
2. 互換性確認
3. 段階的な更新

### Phase 4: テスト・ビルド検証

1. 各パッケージでの単体テスト実行
2. プロジェクト全体での統合テスト
3. 定期確認の実行

## リスク評価

- AWS SDK: メジャーバージョンは同じため破壊的変更は少ない（低リスク）
- TypeScript/Node.js: 既存コードは18対応なので22でも互換性あり（低リスク）
- Langchain: APIの変更可能性があるため慎重に確認（中リスク）

## 期待効果

- セキュリティアップデート適用
- パフォーマンス向上
- 依存関係の整理
- メンテナンス性向上

## 注意事項

- TDD原則に従い、各段階でテスト実行
- 破壊的変更が発見された場合は段階的対応
- コミット前の定期確認を厳守
