# ステップ4: CDKでSNSを設定する

## 作業内容

1. CDKスタックの環境設定を追加
   - `bin/ccqm.ts`を修正して、環境設定を追加
   - デフォルトで`dev`環境を使用するように設定
   - プロジェクトの略称`CCQM`をプレフィックスとして使用

2. SNSトピックの設定
   - `lib/ccqm-stack.ts`を修正して、メール送信用のSNSトピックを追加
   - 環境名とプレフィックスを使用してリソース名を設定
   - CloudFormation出力としてSNSトピックARNを出力

3. AWS SDKユーティリティパッケージの作成
   - `packages/aws-utils`ディレクトリを作成
   - `package.json`と`tsconfig.json`を設定
   - SNSを利用したメール送信ユーティリティ関数を実装
   - CloudFormationからSNSトピックARNを取得する関数を実装
   - メール送信テストスクリプトを作成

4. ルートpackage.jsonの更新
   - CDKデプロイコマンドを追加
   - メール送信テストコマンドを追加

## デプロイ手順

1. CDKスタックをデプロイ

   ```bash
   pnpm cdk:deploy:dev
   ```

2. メール送信テスト

   ```bash
   pnpm test:email <送信先メールアドレス>
   ```

## 確認事項

- [ ] CDKスタックが正常にデプロイされたか
- [ ] SNSトピックが正常に作成されたか
- [ ] メール送信テストが成功したか
- [ ] 送信したメールが正常に届いたか
- [ ] メールの件名と本文に日本時間が含まれているか

## 注意点

- SNSトピックにメールアドレスをサブスクライブするには、最初にAWS SNSコンソールからサブスクリプションを作成し、確認メールのリンクをクリックする必要があります。
- メール送信テストを実行する前に、AWSの認証情報が正しく設定されていることを確認してください。
- 環境変数`AWS_PROFILE`を設定することで、特定のAWSプロファイルを使用できます。
