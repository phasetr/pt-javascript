# ステップ1: CDKコードの書き換えとAWSデプロイ

## 実施内容

1. CDKスタックを修正して以下の要件を満たすようにしました：
   - プロジェクトの略称（CTLD）をプレフィックスとして使用
   - DynamoDBテーブルを作成（PK/SKをキーとして設定）
   - Hono APIとRemixアプリケーションをLambdaにデプロイ
   - CloudWatchログをcdk destroyで削除できるように設定

2. Honoアプリケーションを修正：
   - ルートパスへのアクセス時に「Hello Lambda in Hono!」を返すように変更

3. Remixアプリケーションを修正：
   - Lambda用のハンドラーを作成

4. ローカル開発環境の整備：
   - Docker Composeを使用してDynamoDBをローカルで実行できるように設定
   - DynamoDBテーブルを初期化するスクリプトを作成

## 確認方法

### 1. ローカルDynamoDBの起動と初期化

```bash
# DynamoDBをローカルで起動
npm run dynamodb:start

# テーブルの初期化
npm run dynamodb:init

# テーブルが作成されたことを確認
aws dynamodb list-tables --endpoint-url http://localhost:8000
```

期待される結果:

```json
{
    "TableNames": [
        "CTLD-Table"
    ]
}
```

### 2. CDKのデプロイ

```bash
# AWSプロファイルを設定（必要に応じて）
export AWS_PROFILE=your-profile

# CDKをデプロイ
npm run deploy
```

期待される結果:
CDKスタックが正常にデプロイされ、以下のリソースが作成されます：

- DynamoDBテーブル: CTLD-Table
- Lambda関数: CTLD-HonoApi, CTLD-RemixApp
- API Gateway: CTLD-HonoApiGateway, CTLD-RemixApiGateway

### 3. デプロイされたAPIの動作確認

```bash
# API GatewayのURLを取得
HONO_API_URL=$(aws cloudformation describe-stacks --stack-name CdkTwoLambdaDynamodbStack --query "Stacks[0].Outputs[?OutputKey=='CTLDHonoApiGatewayEndpoint'].OutputValue" --output text)
REMIX_API_URL=$(aws cloudformation describe-stacks --stack-name CdkTwoLambdaDynamodbStack --query "Stacks[0].Outputs[?OutputKey=='CTLDRemixApiGatewayEndpoint'].OutputValue" --output text)

# Hono APIの動作確認
curl $HONO_API_URL

# Remix APIの動作確認（ブラウザで確認することを推奨）
echo "Remix URL: $REMIX_API_URL"
```

期待される結果:

- Hono API: `Hello Lambda in Hono!`
- Remix API: ブラウザでRemixのウェルカムページが表示される

### 4. リソースのクリーンアップ

```bash
# CDKスタックの削除
npm run destroy

# ローカルDynamoDBの停止
npm run dynamodb:stop
```

期待される結果:
すべてのAWSリソースが正常に削除され、ローカルのDynamoDBコンテナが停止します。
